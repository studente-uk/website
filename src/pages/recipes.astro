---
import RecipeCard from "../components/RecipeCard.astro";
import Search from "../components/Search.astro";
import Layout from "../layouts/Layout.astro";
import '../styles/recipies.scss';

const recipes = await Astro.glob("./recipes/*.mdx");
// I am ashamed of this code, but it works

const search = (query: string) => {
    const results = recipes.filter((recipe) => 
        recipe.frontmatter.title.toLowerCase().includes(query.toLowerCase())
    );

    if (results) {
        return results;
    } else {
        return recipes;
    }
}
---

<Layout title="Blog" description="Welcome to my blog!!">
    <h1>Recipes</h1>

     <Search/>

    <div class="recipes">
        {recipes.map((recipe) => {
            const data = recipe.frontmatter;
            const url = recipe.url ?? "";
            if (data.draft) return;
            return (
                <RecipeCard 
                title={data.title}
                url={recipe.url}
                description={data.description}
                time={data.prepT + data.cookT}
                servings={data.servings}
                allergens={data.allergens}
                tags={data.tags}
                />
            );
        })}
    </div>
</Layout>
